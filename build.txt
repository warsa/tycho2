

#---------------------------------------------------------------------------------------
# Env variables and modules (darwin)
#---------------------------------------------------------------------------------------

module unload trilinos/12.12.1-gcc-7.3.0-openmpi-3.1.2-netlib 
module load cuda/9.2

export METIS_DIR=/usr/projects/draco/vendors/spack.power9-0.11.2/opt/spack/linux-rhel7-ppc64le/gcc-7.1.0/metis-5.1.0-mzschmzxwstgx62dicfs5zwzovrjknbk

# these make openmpi play nicely

export OMP_PROC_BIND=true
export OMPI_MCA_btl=^openib
export UCX_NET_DEVICES=mlx5_0:1
export UCX_WARN_UNUSED_ENV_VARS=n

# this avoids having to modify the nvcc_wrapper script

export NVCC_WRAPPER_DEFAULT_COMPILER=mpicxx

#---------------------------------------------------------------------------------------
# NEW cmake 
#---------------------------------------------------------------------------------------

cmake -DUSE_PETSC=OFF -DUSE_KOKKOS=ON -DBUILD_UTILS=ON -DUSE_METIS=ON -DCMAKE_CXX_COMPILER=${HOME}/tycho2/dependencies/kokkos/bin/nvcc_wrapper -DKOKKOS_ENABLE_CUDA=ON -DKOKKOS_ENABLE_OPENMP=ON -DKOKKOS_ENABLE_SERIAL=OFF -DKOKKOS_ARCH="Power9;Volta70" -DKOKKOS_ENABLE_DEPRECATED_CODE=OFF -DKOKKOS_ENABLE_CUDA_LAMBDA=ON ~/tycho2

#---------------------------------------------------------------------------------------
# Run on 2 procs
#---------------------------------------------------------------------------------------

cp ~/tycho2/run.sh .
cp ~/tycho2/input.kokkos .
./run.sh 2

